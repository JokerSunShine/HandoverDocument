---
作者: Joker_Sun
创建时间: 2024-03-06 11:33:41
修改时间: 2024-03-06 11:33:41 
--- 

# 开发时间段
SVN：2022/7/28 ~ 2022/8/26

# 客户端内容
## 问题
用于针对客户端背包在每次增加一个道具时会触发客户端模拟放入背包计算，这里的计算是整个背包遍历计算，帧率会下降 50 帧左右

## 优化方式
优化方式：对于背包格子计算而言，如果在不整理背包和不扩展背包的前提下，背包中的空格只需要计算一遍，后续无需计算
方案：1. 所以这里主要将背包格子的占用和空闲做了缓存处理 2. 优化计算空闲格子的算法

## 优化内容
### 字段意义

| 字段             | 意义               |
| ---------------- | ------------------ |
| `BagGridDic`     | 缓存的所有格子信息 |
| `Line`           | 背包的行           |
| `Row`            | 背包的列           |
| `SpaceDataIsDir` | 是否需要重新计算   |
| `usedList`       | 占用的ItemCell格子 |
| `freeList`       | 空闲的ItemCell格子 |

### 背包计算缓存初始化
1. 当接收到完整的背包内容数据的时候
![[Pasted image 20240307103114.png]]
2. 当接收到完整的仓库内容数据的时候
![[Pasted image 20240307103353.png]]

### 背包空闲格子计算方式
![[Drawing 2024-03-07 10.36.54.excalidraw]]
![[Pasted image 20240307110627.png]]

